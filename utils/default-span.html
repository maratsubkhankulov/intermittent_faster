<!DOCTYPE html>
<html>

<body>

<script>

    directory = [];

</script>

<script src="../lib/jquery-1.9.1.min.js"></script>
<script src="../lib/underscore-min.js"></script>
<script src="../lib/parse-1.2.2.min.js"></script>
<script src="../js/models/model-parse-com.js"></script>

<script>

    Parse.initialize("n13nQ6Xc6nbA1GMydEdUzC5CktBp99yEjws8LVep", "9CKAb8qfYVThFJy1qVd1jQsL8VzULET5MrU0O527");

    var promisesPhase1, promise = [];

    console.log("Creating default span");

    //XXX: Use current date
    var span = new directory.Span({"startDate": "2014-01-08", "endDate": "2014-02-11"});

    var days = 
    new directory.DayCollection(
        [
        {"date": "2014-02-08", "quote": "carpe diem", "author": "Horace", "pic":"img/elder.jpg", "sound":"api.soundcloud.com/tracks/76255568", "viewed":true},
        {"date": "2014-02-09", "quote": "isn't that the whole point?", "author": "Barack Obama", "pic":"img/corfu2.jpg", "sound":"api.soundcloud.com/tracks/28284290", "viewed":false},
        {"date": "2014-02-10", "quote": "I know how hard it is for you to put food on your family.", "author": "George Bush", "pic":"img/cow.jpg", "sound":"api.soundcloud.com/tracks/123450519", "viewed":false},
        {"date": "2014-02-11", "quote": "Imagination is more important than knowledge", "author": "Albert Einstein", "pic":"img/ten.jpg", "sound":"api.soundcloud.com/tracks/20389181", "viewed":false}
        ]
    );

    promise.push(span.save());

    Parse.Promise.when(promise).then( function() {
        days.each(function(day) {
            day.set("spanId", span.id);
            day.save( null, {
                success: function(span) {
                    console.log("Day saved");
                },
                error: function(day, error) {
                    console.log("failed " + error.code + " " + error.message);
                    callbacks.error("Error: span could not be saved");
                }
            });
        });
    });

    promise.push(Parse.User.logIn('me@podarok.com', 'password'));

    Parse.Promise.when(promise).then( function() {
        var user = Parse.User.current();
        user.set("spanId", span.id);

        promise.push(user.save());
    });

    /*Parse.Promise.when(promise).then(function() {
        callbacks.success();
    });*/

    Parse.User.logOut();

</script>

</body>
</html>